
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Í∏∏Ï∞æÍ∏∞ Í≤åÏûÑ</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #reset-button {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 8px 12px;
      font-size: 14px;
      z-index: 10;
    }
    h2, #clear-count, #status {
      font-size: 2vmin;
      margin: 5px;
      text-align: center;
    }
    #map-container {
      flex-grow: 1;
      max-height: 65vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #map {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(6, 1fr);
      gap: 2px;
      width: 60vmin;
      height: 60vmin;
      background-color: #ddd;
      border: 4px solid #888;
      box-sizing: border-box;
    }
    .cell {
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3vmin;
      text-align: center;
      position: relative;
      border: 1px solid #ccc;
    }
    .player-icon {
      transform-origin: center center;
      transition: transform 0.3s ease-in-out;
    }
    .controls {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
    .controls button {
      margin: 5px;
      padding: 10px;
      font-size: 2vmin;
    }
    .cell-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 2vmin;
    }
    .goal-cell {
      background-color: #c0ffc0 !important;
      box-shadow: 0 0 8px 4px #90ee90 inset;
    }
  </style>
</head>
<body>

  <button id="reset-button" onclick="resetGame()">üîÑ Î¶¨ÏÖã</button>
  <h2>Í∏∏Ï∞æÍ∏∞ Í≤åÏûÑ</h2>
  <div id="clear-count">ÌÅ¥Î¶¨Ïñ¥ ÌöüÏàò: 0</div>
  <div id="map-container">
    <div id="map"></div>
  </div>
  <div class="controls">
    <button onclick="speakAndThen(goStraight, 'Go straight')">Go Straight</button>
    <button onclick="speakAndThen(turnLeft, 'Turn left')">Turn Left</button>
    <button onclick="speakAndThen(turnRight, 'Turn right')">Turn Right</button>
  </div>
  <div id="status"></div>

  <script>
    const size = 6;
    const mapDiv = document.getElementById('map');
    const statusDiv = document.getElementById('status');
    const clearCountDiv = document.getElementById('clear-count');

    const buildingEmojis = {
      'hospital': 'üè•',
      'school': 'üè´',
      'library': 'üìö',
      'museum': 'üèõÔ∏è',
      'park': 'üèûÔ∏è',
      'police': 'üöì',
      'post': 'üìÆ',
      'restaurant': 'üçù',
      'fire': 'üöí'
    };

    const impassables = ['fire', 'hospital', 'library', 'museum', 'park', 'police', 'post', 'restaurant'];

    let map = [];
    let player = { x: 0, y: 0, dir: 0 };
    let goal = { x: 5, y: 5 };
    let clearCount = 0;

    function createMap() {
      map = Array.from({ length: size }, () =>
        Array.from({ length: size }, () => null)
      );

      const buildings = ['hospital', 'library', 'museum', 'park', 'police', 'post', 'restaurant', 'fire'];
      const shuffled = buildings.sort(() => 0.5 - Math.random());

      let placed = 0;
      for (let i = 0; i < size && placed < shuffled.length; i++) {
        for (let j = 0; j < size && placed < shuffled.length; j++) {
          if ((i === player.y && j === player.x) || (i === goal.y && j === goal.x)) continue;
          if (Math.random() < 0.25) {
            map[i][j] = shuffled[placed++];
          }
        }
      }
    }

    function drawMap() {
      mapDiv.innerHTML = '';
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';

          const cellContent = document.createElement('div');
          cellContent.className = 'cell-content';

          if (x === player.x && y === player.y) {
            const icon = document.createElement('span');
            icon.textContent = 'üö∂';
            icon.className = 'player-icon';
            icon.style.transform = `rotate(${player.dir * 90}deg)`;
            cellContent.appendChild(icon);
            cell.appendChild(cellContent);
          } else if (x === goal.x && y === goal.y) {
            cell.classList.add('goal-cell');
            cellContent.innerHTML = `<div>üè´</div><small>school</small>`;
            cell.appendChild(cellContent);
          } else {
            const value = map[y][x];
            if (value && buildingEmojis[value]) {
              cellContent.innerHTML = `<div>${buildingEmojis[value]}</div><small>${getBuildingName(value)}</small>`;
              cell.appendChild(cellContent);
            }
          }

          mapDiv.appendChild(cell);
        }
      }
    }

    function getBuildingName(type) {
      const names = {
        'hospital': 'hospital',
        'library': 'library',
        'museum': 'museum',
        'park': 'park',
        'police': 'police station',
        'post': 'post office',
        'restaurant': 'restaurant',
        'fire': 'fire station'
      };
      return names[type] || '';
    }

    function speakAndThen(action, text) {
      const utter = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(utter);
      action();
    }

    function turnLeft() {
      player.dir = (player.dir + 3) % 4;
      drawMap();
    }

    function turnRight() {
      player.dir = (player.dir + 1) % 4;
      drawMap();
    }

    function goStraight() {
      let dx = [0, 1, 0, -1][player.dir];
      let dy = [-1, 0, 1, 0][player.dir];
      let nx = player.x + dx;
      let ny = player.y + dy;
      if (
        nx >= 0 && nx < size && ny >= 0 && ny < size &&
        !impassables.includes(map[ny][nx])
      ) {
        player.x = nx;
        player.y = ny;
        checkWin();
      }
      drawMap();
    }

    function checkWin() {
      if (player.x === goal.x && player.y === goal.y) {
        clearCount++;
        clearCountDiv.textContent = `ÌÅ¥Î¶¨Ïñ¥ ÌöüÏàò: ${clearCount}`;
        statusDiv.textContent = 'üéâ You have arrived at the school! Restarting...';
        setTimeout(resetGame, 2000);
      } else if (!isReachable()) {
        statusDiv.textContent = '‚ùå Impossible! Restarting...';
        setTimeout(resetGame, 1500);
      }
    }

    function isReachable() {
      const visited = Array.from({ length: size }, () => Array(size).fill(false));
      const queue = [[player.x, player.y]];
      visited[player.y][player.x] = true;

      while (queue.length) {
        const [x, y] = queue.shift();
        if (x === goal.x && y === goal.y) return true;
        for (let [dx, dy] of [[0,1],[1,0],[0,-1],[-1,0]]) {
          const nx = x + dx, ny = y + dy;
          if (
            nx >= 0 && nx < size && ny >= 0 && ny < size &&
            !visited[ny][nx] &&
            !impassables.includes(map[ny][nx])
          ) {
            visited[ny][nx] = true;
            queue.push([nx, ny]);
          }
        }
      }
      return false;
    }

    function resetGame() {
      do {
        player = {
          x: Math.floor(Math.random() * size),
          y: Math.floor(Math.random() * size),
          dir: 0
        };
        do {
          goal = {
            x: Math.floor(Math.random() * size),
            y: Math.floor(Math.random() * size)
          };
        } while ((goal.x === player.x && goal.y === player.y) || Math.abs(goal.x - player.x) + Math.abs(goal.y - player.y) < 4);

        createMap();
      } while (!isReachable());

      drawMap();
      statusDiv.textContent = '';
    }

    resetGame();
  </script>
</body>
</html>
